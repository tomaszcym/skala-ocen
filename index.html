<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Skala ocen</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <script src="//unpkg.com/alpinejs" defer></script>
</head>
<body>


<div x-data="app()" class="container">

    <h1 class="display-1 py-4">Skala ocen</h1>

    <div class="row">
        <div class="col col-md-4">

            <div class="card mb-4">
                <div class="card-header">
                    Dane
                </div>
                <div class="card-body">
                    <div class="form-floating mb-3">
                        <input id="max" x-model="max" x-on:input.debounce="onChangeMax($event)" type="number" class="form-control form-control-sm" placeholder="Podaj maksymalną ilość punktów">
                        <label for="max">Maksymalna ilość punktów</label>
                    </div>
                    <div class="form-floating mb-4">
                        <input id="points" x-model="points" x-on:input.debounce="calculate($event)" type="number" class="form-control" placeholder="Podaj ilość punktów">
                        <label for="points">Ilość punktów</label>
                    </div>

                    <h2 class="h4">
                        Ocena: <b><span class="text-bold" x-text="calculatedRate || '-'"></span></b>
                        <template x-if="calculatedPercent">
                            <span>
                                (<small x-text="calculatedPercent"></small>%)
                            </span>
                        </template>
                    </h2>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    Punktacja
                </div>
                <div class="card-body px-0">
                    <table class="table table-striped">
                        <tbody>
                        <template x-for="item in ratings">
                            <tr>
                                <td x-text="getRangeLabel(item)"></td>
                                <td x-text="item.rate"></td>
                            </tr>
                        </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


</div>

<script defer>
    const ratings = [
        {
            rate: '+bdb',
            range: [100, 99],
        },
        {
            rate: 'bdb',
            range: [98, 95],
        },
        {
            rate: '-bdb',
            range: [94, 90],
        },
        {
            rate: '+db',
            range: [89, 85],
        },
        {
            rate: 'db',
            range: [84, 80],
        },
        {
            rate: '-db',
            range: [79, 75],
        },
        {
            rate: '+dst',
            range: [74, 70],
        },
        {
            rate: 'dst',
            range: [69, 59],
        },
        {
            rate: '-dst',
            range: [58, 50],
        },
        {
            rate: '+dop',
            range: [49, 45],
        },
        {
            rate: 'dop',
            range: [44, 40],
        },
        {
            rate: '-dop',
            range: [39, 30],
        },
        {
            rate: 'ndst',
            range: [29, 0],
        },
    ]

    function app() {

        const max = localStorage.getItem('max_points') ?? null
        const points = null
        const calculatedRate = null
        const calculatedPercent = null

        return {
            ratings,
            max,
            points,
            calculatedRate,
            calculatedPercent,
            getRangeLabel(item) {
                const [from, to] = item.range

                return `${from}% - ${to}%`
            },
            onChangeMax() {
                localStorage.setItem('max_points', this.max)

                this.calculate()
            },
            calculate() {
                const res = this.getRate()

                if(res !== null) {
                    const [rate, percent] = res
                    this.calculatedRate = rate
                    this.calculatedPercent = Number(percent).toFixed(0)
                }

                return '-'
            },
            getRate() {
                if(this.points === '' || this.points === null) return null

                const max = Number(this.max)
                const points = Number(this.points)

                if(!max) return null

                const percent = (points / max) * 100;

                const found = ratings.find(r =>
                    percent <= r.range[0] && percent >= r.range[1]
                );

                return [found ? found.rate : null, Math.min(percent, 100)];
            },
        }
    }
</script>

</body>
</html>
